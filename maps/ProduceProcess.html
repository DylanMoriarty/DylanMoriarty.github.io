<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Dylan Moriarty</title>
		<link href="./css/style.css" rel="stylesheet" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Crimson+Text:400,700,400italic' rel='stylesheet' type='text/css'>	</head>	
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" type="text/css">
<body>
<!-- HEADER-->
<div id= "main">
  <div id= "info-container">
  	<div class = "title">
  		/<a href="./index.html">Dylan Moriarty<img src="./img/Lilme.png"></a>
  	</div>
  	<div class = "navbar">
        <a href="./maps.html">Maps</a> 
        <a href="./illustrations.html">Illustrations</a> 
        <a href="./blog.html">Blog</a> 
        <a href="./about.html">About/Contact</a>
  		</ul>
  	</div>
  </div>
<!-- PAGE CONTENT-->
  <div id= "intro">
    <div class="page-root"><p><h1>/ <a href="./maps.html">Cartography </a>/ Produce Produced Around the World, Process</div>
  </div>  
  <div id= "words-content">
    <div class= "illus-linebreak">
    </div>
    <div class= "words">
<p>
<p>Over the last couple weeks, I put together an interactive map on the production of food! ...not the most exciting or revealing tool out there, but hopefully after reading this you'll appreciate why the stuff happening in the background is really, really cool.
<img src="./img/1-Research.jpg"></img>
<p>At first I figured I’d just be scraping Wikipedia for the data on this. Then I discovered almost every other food had it’s data presented in a different way.
<p>After a bit of googling, I found both a reliable source, and uniform data from FAOSTAT. Looked up each commodity…
<div class="bimg"><img src="./img/graph1.png"></img></div>
<p>…grabbed the tables through Google Docs…
<div class="bimg"><img src="./img/graph2.png"></img></div>
<p>…and organized them into this table.
<div class="bimg"><img src="./img/graph3.png"></img></div>
<p>The most important field here is probably the “id”, and it serves as the column to link this data to the topography.
<img src="./img/2-Prototype.jpg"></img>
<div class="bimg"><img src="./img/prototype1.png"></img></div>
<p>The initial design!
<img src="./img/2-SettingUp.jpg"></img>
<p>The tools for this project make a short list:
<ul>
  <li>Natural Earth Data</li>
  <li>GDAL</li>
  <li>TopoJSON</li>
  <li>D3</li>
  <li>Sublime Text (text editor)</li>
  <li>Adobe Photoshop / Illustrator</li>
</ul>
<p>Usually I don’t include the step of installing software or preparing the tools to be used because it’s as simple as installing a executable file, clicking twice, and running the program. Setting up TopoJSON ended up being a surprising struggle. 
<p>Why TopoJSON? Well, the goto file type for working with geographic data are .shp files. Those are faaaar to large to properly load and work with online. The original Natural Earth Dataset for world countries has a shape file that’s 182.7 kB, and attribute file that’s 1.8 MB. After conversion the .TopoJSON file was only 89.7 kB. Much more workable.
<p>The drastic difference comes from cutting away all the unnecessary data, cleanup, and drawing the paths in a more compact way. In the original file there were 59 different attributes for things ranging from Country Name to Continent, to lots of various administrative codes. After conversion, the only bits preserved besides the topography was just one of the admin codes. 
<p>There are a couple of tools online which allow us to do a typical two click conversion, but they’re still pretty fickle. The one I’d heard most success from, Shape Escape, always crashed when I tried to use it. Another one, Map Shaper, worked fine for me, but I thought the file it exported was terribly messy.
<p>Instead of relying on those sites, I decided to try to follow Bostock’s guide for running the file conversion in node.JS. I liked the higher control on the output having it set up would allow, and especially not having to rely on the previously mentioned online tools.
<p>Doing this on Windows proved…. unproductive. Bostock wrote his with Mac in mind. Answers to other frustrated folks on coding advice sites from 1 to 2 years ago proved to be the only place to find guides or help on it. It also didn’t help that this was my first major foray into installing through the Command Prompt.
<p>The big issue here seemed to be that Windows system files aren’t entirely uniform. There are additional components that need to be installed, and due to the dated nature of the online answers, trying to find the version that led that person to a workable solution led to nothing but dead ends. 
<p>SO, I decided to follow the advice of my peers when asked how to get it working on a windows: "Don’t bother."
<p>Luckily, I also have a laptop running Linux, which is much more forgiving for command prompt installation. After three days trying to get this to work on Windows, in one night I got it up and working in Linux.
<p>Still with me? Cool. Here’s a gif to make up for the long blocks of text.
<div class="bimg"><img src = "./img/nicgif.gif"></img></div>
<img src = "./img/4-StopWorrying.jpg"></img>
<div class="bimg"><img src = "./img/code.png"></img></div>
<p>And here’s where the bulk of the project took place.
<p>To summarize, the script is doing the following:
<ol>
<li>Drawing “invisible” svg circles over the food icons.</li>
<li>Declaring “states” based on the csv data (“Apples”, “Bananas” etc.) that update when a new food icon is clicked.</li>
<li>Drawing the map from the Topojson.</li>
<li>Projecting the map into Equirectangular.</li>
<li>Linking the Topojson with the CSV through the common field.</li>
<li>Defining a color scale that goes with each “state”.</li>
<li>Color the countries based on the color scale and “state”.</li>
<li>Highlight the countries when hovered over.</li>
<li>Dehighlight the countries when hovered off.</li>
<li>Create an info bar below the map.</li>
<li>Update the info bar to show the selected food when “state” is changed.</li>
<li>Update the info bar to show the details on a countries production when that country is hovered over with the mouse.</li>
</ol>
<p>…and it took awhile to get working. The title of this section is definitely an overdone joke, but it’s entirely appropriate here. While learning how D3 functions was valuable, there’s a lot to be said for the simple troubleshooting skills learned. 

<p>Particularly for me, building a project entirely through script is still a foreign approach. Building this way requires a very careful approach, and a lot of future sight. It was a lot of sprinting into walls, good solid progress for an hour or so, and then a oddity or problem that required a long sit down session to work out. A few notable issues included:
<ul>
<li>Only creating bars in the graph for the 20 countries selected, not the 111 in the dataset.</li>
<li>Figuring out why the icon box was drawing weird sizes.</li>
<li>Figuring out why some countries wouldn’t select. Turned out to be an issue with it being based on the “name” of a country, which for ones like the United States of America included a space. JS didn’t like that.</li>
</ul>
<p>I had hoped to include a block that would explain why a food grew where it did, but these walls took me into deadline mode. 
<div class="bimg"><img src = "./img/dev1.png"></img></div>
<p>It’s hard to consider the issues in hindsight because the solutions were ultimately mostly simple and straightforward. The code’s not perfect or pretty by any means, but it’s functional- and at the end of the day, that face value is what matters most.
<img src="5-Embellishments"></img>
<p>About 1% of the time on this project was spent in my usual stomping grounds: Illustrator and Photoshop. 
<div class="bimg"><img src = "./img/dev2.png"></img></div>
<p>Not much to say here. Did the title and lower images as a reprieve from coding, and most of these food icons at the very end once everything was up and running.
<img src="./img/6-Final.jpg"></img>
<div class="bimg"><img src = "./img/finalproduct.png"></img></div>
<p>…and there we have it! A static map built entirely from data alone.
<p>Besides the flexibility this approach offers towards data type and construction,  the really nice thing is that at any point I can change the data on either the topography or food sides and with a few tweaks, everything will still work perfectly.
<p>To highlight this, in just an hour and a half, I went through the project again- finding data, compiling it, and drawing a few more icons- and completely changed what the map displays.
<div class="bimg"><img src = "./img/finalproduct2.png"></img></div>
<div class="date"><p>11/22/2014</div>


    </div>
    <div class="Back">
     <p>/<a href="./index.html">Dylan Moriarty </a>/<a href="./maps.html">Cartography </a>/<a href="#">To Top</a>
    </div>
  </div>
<!--         END OF CONTENT CONTAINER    -->
</div>

<div class="footer">
  <div class ="footer-content">
    <p><a href="https://github.com/DylanMoriarty" target="_blank"><i class="fa fa-github fa-2x"></i></a>
      <a href="http://linkedin.com/in/DylanMoriarty" target="_blank"><i class="fa fa-linkedin-square fa-2x"></a></i>
      <a href="https://twitter.com/DylanMoriarty" target="_blank"><i class="fa fa-twitter fa-2x"></i></a>
    <p>Dylan Moriarty © 2015
  </div>
</div>
<!-- FOOTER -->
</body>

</html>
<!-- 
<div id= "page-title-container">
    <div class="page-root"><p><h1>Cartography</h1></div><div class="page-root-center">Static Maps</div>
  </div> -->